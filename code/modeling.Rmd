---
title: "PepBio: a web server for predicting the bioactivity of host defense peptide"
author: Saw Simeon, Hao Li, Aijaz Ahmad Malik, Abdul Hafeez Kandhro, Theeraphon Piacham, Virapong Prachayasittikul, Jarl E. S. Wikberg and Chanin Nantasanamat
date: "October 13, 2015"
output: html_document
---




```{r, echo = FALSE, eval = TRUE, cache = TRUE}
### Read FASTA
library(protr)
cancer <- readFASTA("cancer.fasta")
fungus <- readFASTA("fungus.fasta")
bacteria <- readFASTA("bacteria.fasta")
virus <- readFASTA("virus.fasta")
negative <- protr::readFASTA("negative.fasta")

### Remove problematic peptide
cancer <- cancer[(sapply(cancer, protcheck))]
fungus <- fungus[(sapply(fungus, protcheck))]
bacteria <- bacteria[(sapply(bacteria, protcheck))]
virus <- virus[(sapply(virus, protcheck))]
negative <- negative[(sapply(negative, protcheck))]


### Calculate descriptors
cancer_des <- t(sapply(cancer, extractAAC))
fungus_des <- t(sapply(fungus, extractAAC))
bacteria_des <- t(sapply(bacteria, extractAAC))
virus_des <- t(sapply(virus, extractAAC))
negative_des <- t(sapply(negative, extractAAC))
#### label the labels 
cancer_des <- as.data.frame(cancer_des)
cancer_des$Label <- "Cancer"
fungus_des <- as.data.frame(fungus_des)
fungus_des$Label <- "Fungus"
bacteria_des <- as.data.frame(bacteria_des)
bacteria_des$Label <- "Bacteria"
virus_des <- as.data.frame(virus_des)
virus_des$Label <- "Virus"
negative_des <- as.data.frame(negative_des)
negative_des$Label <- "Negative"

cancer <- rbind(cancer_des, negative_des)
cancer$Label <- as.factor(cancer$Label)
fungus <- rbind(fungus_des, negative_des)
fungus$Label <- as.factor(fungus$Label)
bacteria <- rbind(fungus_des, negative_des)
bacteria$Label <- as.factor(bacteria$Label)
virus <- rbind(virus_des, negative_des)
virus$Label <- as.factor(virus$Label)

input <- list(cancer = cancer, fungus = fungus, bacteria = bacteria, 
              virus = virus)

#### Training results using J48
J48_training <- function(x) {
  
  results <- list(100)
  for (i in 1:100) {
    in_train <- caret::createDataPartition(x$Label, p = 0.80, list = FALSE)
    train <- x[in_train, ]
    test <- x[-in_train, ]
    model_train <- RWeka::J48(Label~., data = train)
    summary <- summary(model_train)
    confusionmatrix <- summary$confusionMatrix
    results[[i]] <- as.numeric(confusionmatrix)
  }
  return(results)
}

mean_and_sd <- function(x) {
  c(round(mean(x, na.rm = TRUE), digits = 4),
    round(sd(x, na.rm = TRUE), digits = 4))
}

J48_train <- function(x) {
  ok <- J48_training(x)
  results <- data.frame(ok)
  data <- data.frame(results)
  m = ncol(data)
  ACC  <- matrix(nrow = m, ncol = 1)
  SENS  <- matrix(nrow = m, ncol = 1)
  SPEC  <-matrix(nrow = m, ncol = 1)
  MCC <- matrix(nrow = m, ncol = 1)
  
  for(i in 1:m){ 
    ACC[i,1]  = (data[1,i]+data[4,i])/(data[1,i]+data[2,i]+data[3,i]+data[4,i])*100
    SENS[i,1]  =  (data[4,i])/(data[3,i]+data[4,i])*100
    SPEC[i,1]  = (data[1,i]/(data[1,i]+data[2,i]))*100
    MCC1      = (data[1,i]*data[4,i]) - (data[2,i]*data[3,i])
    MCC2      =  (data[4,i]+data[2,i])*(data[4,i]+data[3,i])
    MCC3      =  (data[1,i]+data[2,i])*(data[1,i]+data[3,i])
    MCC4  =  sqrt(MCC2)*sqrt(MCC3)
    
    
    MCC[i,1]  = MCC1/MCC4
  }
  results_ACC <- mean_and_sd(ACC)
  results_SENS <- mean_and_sd(SENS)
  results_SPEC <- mean_and_sd(SPEC)
  results_MCC <- mean_and_sd(MCC)
  results_all <- (data.frame(c(results_ACC, results_SENS, results_SPEC, results_MCC)))
  rownames(results_all) <- c("ACC_Mean", "ACC_SD", "Sens_Mean", "Sens_SD", "Spec_Mean", "Spec_SD",
                             "MCC_Mean", "MCC_SD")
  return(results_all)
}

#### 10-fold results using J48
J48_10fold <- function(x) {
  results <- list(100)
  for (i in 1:100) {
    in_train <- caret::createDataPartition(x$Label, p = 0.80, list = FALSE)
    train <- x[in_train, ]
    test <- x[-in_train, ]
    model_train <- RWeka::J48(Label~., data = train)
    eval_j48 <- RWeka::evaluate_Weka_classifier(model_train, numFolds = 10, complexity = FALSE, seed = 1, class = TRUE)
    confusionmatrix <- eval_j48$confusionMatrix
    results[[i]] <- as.numeric(confusionmatrix)
  }
  return(results)
}

J48_cross_validation <- function(x) {
  ok <- J48_10fold(x)
  results <- data.frame(ok)
  data <- data.frame(results)
  m = ncol(data)
  ACC  <- matrix(nrow = m, ncol = 1)
  SENS  <- matrix(nrow = m, ncol = 1)
  SPEC  <-matrix(nrow = m, ncol = 1)
  MCC <- matrix(nrow = m, ncol = 1)
  
  for(i in 1:m){ 
    ACC[i,1]  = (data[1,i]+data[4,i])/(data[1,i]+data[2,i]+data[3,i]+data[4,i])*100
    SENS[i,1]  =  (data[4,i])/(data[3,i]+data[4,i])*100
    SPEC[i,1]  = (data[1,i]/(data[1,i]+data[2,i]))*100
    MCC1      = (data[1,i]*data[4,i]) - (data[2,i]*data[3,i])
    MCC2      =  (data[4,i]+data[2,i])*(data[4,i]+data[3,i])
    MCC3      =  (data[1,i]+data[2,i])*(data[1,i]+data[3,i])
    MCC4  =  sqrt(MCC2)*sqrt(MCC3)
    
    
    MCC[i,1]  = MCC1/MCC4
  }
  results_ACC <- mean_and_sd(ACC)
  results_SENS <- mean_and_sd(SENS)
  results_SPEC <- mean_and_sd(SPEC)
  results_MCC <- mean_and_sd(MCC)
  results_all <- (data.frame(c(results_ACC, results_SENS, results_SPEC, results_MCC)))
  rownames(results_all) <- c("ACC_Mean", "ACC_SD", "Sens_Mean", "Sens_SD", "Spec_Mean", "Spec_SD",
                             "MCC_Mean", "MCC_SD")
  return(results_all)
}

### Testing results using J48
J48_testing <- function(x) {
  results <- list(100)
  for (i in 1:100) {
    in_train <- caret::createDataPartition(x$Label, p = 0.80, list = FALSE)
    train <- x[in_train, ]
    test <- x[-in_train, ]
    model_train <- RWeka::J48(Label~., data = train)
    eval_external <- RWeka::evaluate_Weka_classifier(model_train, newdata = test, numFolds = 0, complexity = FALSE, seed = 1, class = TRUE)
    confusionmatrix <- eval_external$confusionMatrix
    results[[i]] <- as.numeric(confusionmatrix)
  }
  return(results)
}


J48_external <- function(x) {
  ok <- J48_testing(x)
  results <- data.frame(ok)
  data <- data.frame(results)
  m = ncol(data)
  ACC  <- matrix(nrow = m, ncol = 1)
  SENS  <- matrix(nrow = m, ncol = 1)
  SPEC  <-matrix(nrow = m, ncol = 1)
  MCC <- matrix(nrow = m, ncol = 1)
  
  for(i in 1:m){ 
    ACC[i,1]  = (data[1,i]+data[4,i])/(data[1,i]+data[2,i]+data[3,i]+data[4,i])*100
    SENS[i,1]  =  (data[4,i])/(data[3,i]+data[4,i])*100
    SPEC[i,1]  = (data[1,i]/(data[1,i]+data[2,i]))*100
    MCC1      = (data[1,i]*data[4,i]) - (data[2,i]*data[3,i])
    MCC2      =  (data[4,i]+data[2,i])*(data[4,i]+data[3,i])
    MCC3      =  (data[1,i]+data[2,i])*(data[1,i]+data[3,i])
    MCC4  =  sqrt(MCC2)*sqrt(MCC3)
    
    
    MCC[i,1]  = MCC1/MCC4
  }
  results_ACC <- mean_and_sd(ACC)
  results_SENS <- mean_and_sd(SENS)
  results_SPEC <- mean_and_sd(SPEC)
  results_MCC <- mean_and_sd(MCC)
  results_all <- (data.frame(c(results_ACC, results_SENS, results_SPEC, results_MCC)))
  rownames(results_all) <- c("ACC_Mean", "ACC_SD", "Sens_Mean", "Sens_SD", "Spec_Mean", "Spec_SD",
                             "MCC_Mean", "MCC_SD")
  return(results_all)
}

results_J48 <- function(x) {
  training <- J48_train(x)
  cross_validation <- J48_cross_validation(x)
  testing <- J48_external(x)
  results <- data.frame(Training = training, Cross_Validation = cross_validation, Testing = testing)
  colnames(results) <- c("Training set", "Internal validation", "External set")
  return(results)
}

```

### HDPs having their bioactivity merged with the negative data set to build seperate models ###

```{r, echo = FALSE, eval = TRUE, cache = TRUE}
suppressPackageStartupMessages(library(parallel))
suppressPackageStartupMessages(library(doSNOW))
cl <- makeCluster(8)
registerDoSNOW(cl)
clusterExport(cl = cl, ls())

result_J48_performance <- parLapply(cl = cl, input, function(x) {
  models <- suppressWarnings(results_J48(x))
  return(models)
})
print(result_J48_performance)
stopCluster(cl)
```

```{r, echo = FALSE, eval = TRUE, cahce = TRUE}

### Read FASTA
library(protr)
cancer <- readFASTA("cancer.fasta")
fungus <- readFASTA("fungus.fasta")
bacteria <- readFASTA("bacteria.fasta")
virus <- readFASTA("virus.fasta")
negative <- protr::readFASTA("negative.fasta")

### Remove problematic peptides
cancer <- cancer[(sapply(cancer, protcheck))]
fungus <- fungus[(sapply(fungus, protcheck))]
bacteria <- bacteria[(sapply(bacteria, protcheck))]
virus <- virus[(sapply(virus, protcheck))]
negative <- negative[(sapply(negative, protcheck))]


### Calculate descriptors
cancer_des <- t(sapply(cancer, extractAAC))
fungus_des <- t(sapply(fungus, extractAAC))
bacteria_des <- t(sapply(bacteria, extractAAC))
virus_des <- t(sapply(virus, extractAAC))
negative_des <- t(sapply(negative, extractAAC))
#### label the labels 
cancer_des <- as.data.frame(cancer_des)
fungus_des <- as.data.frame(fungus_des)
bacteria_des <- as.data.frame(bacteria_des)
virus_des <- as.data.frame(virus_des)
hdp <- rbind(cancer_des, fungus_des, bacteria_des, virus_des)
hdp$Label <- "Positive"
hdp <- as.data.frame(hdp)
negative_des <- as.data.frame(negative_des)
negative_des$Label <- "Negative"

data <- rbind(hdp, negative_des)
data$Label <- as.factor(data$Label)


results_J48 <- function(x) {
  training <- J48_train(x)
  cross_validation <- J48_cross_validation(x)
  testing <- J48_external(x)
  results <- data.frame(Training = training, Cross_Validation = cross_validation, Testing = testing)
  colnames(results) <- c("Training set", "Internal validation", "External set")
  return(results)
}
```

### HDPs having anti--bacteria, anti--cancer, anti--fungus and anti-viral bioactivities combined into the HDP set while the negative set was used as non--HDPs ###

```{r, echo = FALSE, eval = TRUE, cache = TRUE}

result_J48_performance <- suppressMessages(results_J48(data))
print(result_J48_performance)
```

```{r, echo = FALSE, eval = TRUE, cache = TRUE}
### Read FASTA
library(protr)
cancer <- readFASTA("cancer.fasta")
fungus <- readFASTA("fungus.fasta")
bacteria <- readFASTA("bacteria.fasta")
virus <- readFASTA("virus.fasta")
negative <- protr::readFASTA("negative.fasta")

### Remove problematic peptides
cancer <- cancer[(sapply(cancer, protcheck))]
fungus <- fungus[(sapply(fungus, protcheck))]
bacteria <- bacteria[(sapply(bacteria, protcheck))]
virus <- virus[(sapply(virus, protcheck))]
negative <- negative[(sapply(negative, protcheck))]

### Calculate amino acid composition
composition <- function(x) {
  library(protr)
  c(extractAAC(x))
}

### Calculate descriptors
cancer_des <- t(sapply(cancer, extractAAC))
fungus_des <- t(sapply(fungus, extractAAC))
bacteria_des <- t(sapply(bacteria, extractAAC))
virus_des <- t(sapply(virus, extractAAC))
negative_des <- t(sapply(negative, extractAAC))
#### label the labels 
cancer_des <- as.data.frame(cancer_des)
cancer_des$Label <- "Cancer"
fungus_des <- as.data.frame(fungus_des)
fungus_des$Label <- "Fungus"
bacteria_des <- as.data.frame(bacteria_des)
bacteria_des$Label <- "Bacteria"
virus_des <- as.data.frame(virus_des)
virus_des$Label <- "Virus"
combine_data <- rbind(cancer_des, fungus_des,
                      bacteria_des, virus_des)
combine_data$Label <- as.factor(combine_data$Label)
```


```{r, echo = FALSE, eval = TRUE, cache = TRUE}
#### Training results using J48
J48_training <- function(x, Label){
  if (Label == "Bacteria") {
    suppressPackageStartupMessages(library(parallel))
    suppressPackageStartupMessages(library(doSNOW))
    cl <- makeCluster(8)
    registerDoSNOW(cl)
    
    ok <- list(100)
    ok <- foreach(i = 1:100) %dopar% { 
      in_train <- caret::createDataPartition(x$Label, p = 0.80, list = FALSE)
      train <- x[in_train, ]
      test <- x[-in_train, ]
      rm(in_train)
      rm(test)
      model_train <- RWeka::J48(Label~., data = train)
      actual <- train$Label
      prediction <- predict(model_train, train)
      rm(train)
      rm(model_train)
      results <- caret::confusionMatrix(prediction, actual)
      results <- results$table
      results <- table(prediction, actual)
      rm(prediction)
      rm(actual)
      results <- as.numeric(results)
      ok[[i]] <- cbind(results[[1]], (results[[5]] + results[[9]] + results[[13]]),
                        (results[[2]] + results[[3]] + results[[4]]), (results[[6]] + results[[11]] + results[[16]]))
      Cancer <- cbind(results[[6]], (results[[2]] + results[[10]] + results[[14]]), 
                      (results[[5]] + results[[7]] + results[[8]]), (results[[1]] + results[[11]] + results[[16]]))
      Fungus <- cbind(results[[11]], (results[[3]] + results[[7]] + results[[15]]),
                      (results[[9]] + results[[10]] + results[[12]]), (results[[1]] + results[[6]] + results[[16]]))
      Virus <- cbind(results[[16]], (results[[4]] + results[[8]] + results[[12]]), 
                     (results[[13]] + results[[14]] + results[[15]]), (results[[1]] + results[[6]] + results[[11]]))
    }
  }  else if (Label == "Cancer") {
    cl <- makeCluster(8)
    registerDoSNOW(cl)
    
    ok <- list(100)
    ok <- foreach(i = 1:100) %dopar% { 
      in_train <- caret::createDataPartition(x$Label, p = 0.80, list = FALSE)
      train <- x[in_train, ]
      test <- x[-in_train, ]
      rm(in_train)
      rm(test)
      model_train <- RWeka::J48(Label~., data = train)
      actual <- train$Label
      prediction <- predict(model_train, train)
      rm(train)
      rm(model_train)
      results <- caret::confusionMatrix(prediction, actual)
      results <- results$table
      results <- table(prediction, actual)
      results <- as.numeric(results)
      rm(prediction)
      rm(actual)
      Bacteria <- cbind(results[[1]], (results[[5]] + results[[9]] + results[[13]]),
                        (results[[2]] + results[[3]] + results[[4]]), (results[[6]] + results[[11]] + results[[16]]))
      ok[[i]] <- cbind(results[[6]], (results[[2]] + results[[10]] + results[[14]]), 
                      (results[[5]] + results[[7]] + results[[8]]), (results[[1]] + results[[11]] + results[[16]]))
      Fungus <- cbind(results[[11]], (results[[3]] + results[[7]] + results[[15]]),
                      (results[[9]] + results[[10]] + results[[12]]), (results[[1]] + results[[6]] + results[[16]]))
      Virus <- cbind(results[[16]], (results[[4]] + results[[8]] + results[[12]]), 
                     (results[[13]] + results[[14]] + results[[15]]), (results[[1]] + results[[6]] + results[[11]]))    
      } 
  }  else if (Label == "Fungus") {
    cl <- makeCluster(8)
    registerDoSNOW(cl)
    
    ok <- list(100)
    ok <- foreach(i = 1:100) %dopar% { 
      in_train <- caret::createDataPartition(x$Label, p = 0.80, list = FALSE)
      train <- x[in_train, ]
      test <- x[-in_train, ]
      rm(test)
      rm(in_train)
      model_train <- RWeka::J48(Label~., data = train)
      actual <- train$Label
      prediction <- predict(model_train, train)
      rm(model_train)
      rm(train)
      results <- caret::confusionMatrix(prediction, actual)
      results <- results$table
      results <- table(prediction, actual)
      results <- as.numeric(results)
      rm(actual)
      rm(prediction)
      
      Bacteria <- cbind(results[[1]], (results[[5]] + results[[9]] + results[[13]]),
                        (results[[2]] + results[[3]] + results[[4]]), (results[[6]] + results[[11]] + results[[16]]))
      Cancer <- cbind(results[[6]], (results[[2]] + results[[10]] + results[[14]]), 
                      (results[[5]] + results[[7]] + results[[8]]), (results[[1]] + results[[11]] + results[[16]]))
      ok[[i]] <- cbind(results[[11]], (results[[3]] + results[[7]] + results[[15]]),
                      (results[[9]] + results[[10]] + results[[12]]), (results[[1]] + results[[6]] + results[[16]]))
      Virus <- cbind(results[[16]], (results[[4]] + results[[8]] + results[[12]]), 
                     (results[[13]] + results[[14]] + results[[15]]), (results[[1]] + results[[6]] + results[[11]]))    
    } 
  }  else if (Label == "Virus") {
    cl <- makeCluster(8)
    registerDoSNOW(cl)
    
    ok <- list(100)
    ok <- foreach(i = 1:100) %dopar% { 
      in_train <- caret::createDataPartition(x$Label, p = 0.80, list = FALSE)
      train <- x[in_train, ]
      test <- x[-in_train, ]
      rm(in_train)
      rm(test)
      model_train <- RWeka::J48(Label~., data = train)
      actual <- train$Label
      prediction <- predict(model_train, train)
      rm(model_train)
      rm(train)
      results <- caret::confusionMatrix(prediction, actual)
      results <- results$table
      results <- table(prediction, actual)
      results <- as.numeric(results)
      rm(prediction)
      rm(actual)
      Bacteria <- cbind(results[[1]], (results[[5]] + results[[9]] + results[[13]]),
                        (results[[2]] + results[[3]] + results[[4]]), (results[[6]] + results[[11]] + results[[16]]))
      Cancer <- cbind(results[[6]], (results[[2]] + results[[10]] + results[[14]]), 
                      (results[[5]] + results[[7]] + results[[8]]), (results[[1]] + results[[11]] + results[[16]]))
      Fungus <- cbind(results[[11]], (results[[3]] + results[[7]] + results[[15]]),
                      (results[[9]] + results[[10]] + results[[12]]), (results[[1]] + results[[6]] + results[[16]]))
      ok[[i]] <- cbind(results[[16]], (results[[4]] + results[[8]] + results[[12]]), 
                     (results[[13]] + results[[14]] + results[[15]]), (results[[1]] + results[[6]] + results[[11]]))    
    }
    return(ok)
    stopCluster(cl)
  } }

mean_and_sd <- function(x) {
  c(round(mean(x, na.rm = TRUE), digits = 4),
    round(sd(x, na.rm = TRUE), digits = 4))
}


results_training_Bacteria <- function(x) {
  yes <- J48_training(x, Label = "Bacteria")
  great <- data.frame(yes)
  rm(yes)
  TP <- seq(from = 1, to = 400, by = 4)
  FN <- seq(from = 2, to = 400, by = 4)
  FP <- seq(from = 3, to = 400, by = 4)
  TN <- seq(from = 4, to = 400, by = 4)
  results <- mapply(c, great[TP], great[FN], great[FP], great[TN])
  rm(great)
  data <- data.frame(results)
  rm(results)
  m = ncol(data)
  ACC  <- matrix(nrow = m, ncol = 1)
  SENS  <- matrix(nrow = m, ncol = 1)
  SPEC  <-matrix(nrow = m, ncol = 1)
  MCC <- matrix(nrow = m, ncol = 1)
  
  for(i in 1:m){ 
    ACC[i,1]  = (data[1,i]+data[4,i])/(data[1,i]+data[2,i]+data[3,i]+data[4,i])*100
    SENS[i,1]  =  (data[4,i])/(data[3,i]+data[4,i])*100
    SPEC[i,1]  = (data[1,i]/(data[1,i]+data[2,i]))*100
    MCC1      = (data[1,i]*data[4,i]) - (data[2,i]*data[3,i])
    MCC2      =  (data[4,i]+data[2,i])*(data[4,i]+data[3,i])
    MCC3      =  (data[1,i]+data[2,i])*(data[1,i]+data[3,i])
    MCC4  =  sqrt(MCC2)*sqrt(MCC3)
    
    
    MCC[i,1]  = MCC1/MCC4
  }
  rm(TP)
  rm(FP)
  rm(TN)
  rm(FN)
  results_ACC <- mean_and_sd(ACC)
  results_SENS <- mean_and_sd(SENS)
  results_SPEC <- mean_and_sd(SPEC)
  results_MCC <- mean_and_sd(MCC)
  rm(ACC)
  rm(SENS)
  rm(SPEC)
  rm(MCC)
  results_all <- (data.frame(c(results_ACC, results_SENS, results_SPEC, results_MCC)))
  rownames(results_all) <- c("ACC_Mean", "ACC_SD", "Sens_Mean", "Sens_SD", "Spec_Mean", "Spec_SD",
                             "MCC_Mean", "MCC_SD")
  rm(results_ACC)
  rm(results_SENS)
  rm(results_SPEC)
  rm(results_MCC)
  return(results_all)
}

results_training_Cancer <- function(x) {
  yes <- J48_training(x, Label = "Cancer")
  great <- data.frame(yes)
  rm(yes)
  TP <- seq(from = 1, to = 400, by = 4)
  FN <- seq(from = 2, to = 400, by = 4)
  FP <- seq(from = 3, to = 400, by = 4)
  TN <- seq(from = 4, to = 400, by = 4)
  results <- mapply(c, great[TP], great[FN], great[FP], great[TN])
  rm(great)
  data <- data.frame(results)
  rm(results)
  m = ncol(data)
  ACC  <- matrix(nrow = m, ncol = 1)
  SENS  <- matrix(nrow = m, ncol = 1)
  SPEC  <-matrix(nrow = m, ncol = 1)
  MCC <- matrix(nrow = m, ncol = 1)
  
  for(i in 1:m){ 
    ACC[i,1]  = (data[1,i]+data[4,i])/(data[1,i]+data[2,i]+data[3,i]+data[4,i])*100
    SENS[i,1]  =  (data[4,i])/(data[3,i]+data[4,i])*100
    SPEC[i,1]  = (data[1,i]/(data[1,i]+data[2,i]))*100
    MCC1      = (data[1,i]*data[4,i]) - (data[2,i]*data[3,i])
    MCC2      =  (data[4,i]+data[2,i])*(data[4,i]+data[3,i])
    MCC3      =  (data[1,i]+data[2,i])*(data[1,i]+data[3,i])
    MCC4  =  sqrt(MCC2)*sqrt(MCC3)
    
    
    MCC[i,1]  = MCC1/MCC4
  }
  rm(TP)
  rm(FP)
  rm(TN)
  rm(FN)
  results_ACC <- mean_and_sd(ACC)
  results_SENS <- mean_and_sd(SENS)
  results_SPEC <- mean_and_sd(SPEC)
  results_MCC <- mean_and_sd(MCC)
  rm(ACC)
  rm(SENS)
  rm(SPEC)
  rm(MCC)
  results_all <- (data.frame(c(results_ACC, results_SENS, results_SPEC, results_MCC)))
  rownames(results_all) <- c("ACC_Mean", "ACC_SD", "Sens_Mean", "Sens_SD", "Spec_Mean", "Spec_SD",
                             "MCC_Mean", "MCC_SD")
  rm(results_ACC)
  rm(results_SENS)
  rm(results_SPEC)
  rm(results_MCC)
  return(results_all)
}



results_training_Fungus <- function(x) {
  yes <- J48_training(x, Label = "Fungus")
  great <- data.frame(yes)
  rm(yes)
  TP <- seq(from = 1, to = 400, by = 4)
  FN <- seq(from = 2, to = 400, by = 4)
  FP <- seq(from = 3, to = 400, by = 4)
  TN <- seq(from = 4, to = 400, by = 4)
  results <- mapply(c, great[TP], great[FN], great[FP], great[TN])
  rm(great)
  data <- data.frame(results)
  rm(results)
  m = ncol(data)
  ACC  <- matrix(nrow = m, ncol = 1)
  SENS  <- matrix(nrow = m, ncol = 1)
  SPEC  <-matrix(nrow = m, ncol = 1)
  MCC <- matrix(nrow = m, ncol = 1)
  
  for(i in 1:m){ 
    ACC[i,1]  = (data[1,i]+data[4,i])/(data[1,i]+data[2,i]+data[3,i]+data[4,i])*100
    SENS[i,1]  =  (data[4,i])/(data[3,i]+data[4,i])*100
    SPEC[i,1]  = (data[1,i]/(data[1,i]+data[2,i]))*100
    MCC1      = (data[1,i]*data[4,i]) - (data[2,i]*data[3,i])
    MCC2      =  (data[4,i]+data[2,i])*(data[4,i]+data[3,i])
    MCC3      =  (data[1,i]+data[2,i])*(data[1,i]+data[3,i])
    MCC4  =  sqrt(MCC2)*sqrt(MCC3)
    
    
    MCC[i,1]  = MCC1/MCC4
  }
  rm(TP)
  rm(FP)
  rm(TN)
  rm(FN)
  results_ACC <- mean_and_sd(ACC)
  results_SENS <- mean_and_sd(SENS)
  results_SPEC <- mean_and_sd(SPEC)
  results_MCC <- mean_and_sd(MCC)
  rm(ACC)
  rm(SENS)
  rm(SPEC)
  rm(MCC)
  results_all <- (data.frame(c(results_ACC, results_SENS, results_SPEC, results_MCC)))
  rownames(results_all) <- c("ACC_Mean", "ACC_SD", "Sens_Mean", "Sens_SD", "Spec_Mean", "Spec_SD",
                             "MCC_Mean", "MCC_SD")
  rm(results_ACC)
  rm(results_SENS)
  rm(results_SPEC)
  rm(results_MCC)
  return(results_all)
}


results_training_Virus <- function(x) {
  yes <- J48_training(x, Label = "Virus")
  great <- data.frame(yes)
  rm(yes)
  TP <- seq(from = 1, to = 400, by = 4)
  FN <- seq(from = 2, to = 400, by = 4)
  FP <- seq(from = 3, to = 400, by = 4)
  TN <- seq(from = 4, to = 400, by = 4)
  results <- mapply(c, great[TP], great[FN], great[FP], great[TN])
  rm(great)
  data <- data.frame(results)
  rm(results)
  m = ncol(data)
  ACC  <- matrix(nrow = m, ncol = 1)
  SENS  <- matrix(nrow = m, ncol = 1)
  SPEC  <-matrix(nrow = m, ncol = 1)
  MCC <- matrix(nrow = m, ncol = 1)
  
  for(i in 1:m){ 
    ACC[i,1]  = (data[1,i]+data[4,i])/(data[1,i]+data[2,i]+data[3,i]+data[4,i])*100
    SENS[i,1]  =  (data[4,i])/(data[3,i]+data[4,i])*100
    SPEC[i,1]  = (data[1,i]/(data[1,i]+data[2,i]))*100
    MCC1      = (data[1,i]*data[4,i]) - (data[2,i]*data[3,i])
    MCC2      =  (data[4,i]+data[2,i])*(data[4,i]+data[3,i])
    MCC3      =  (data[1,i]+data[2,i])*(data[1,i]+data[3,i])
    MCC4  =  sqrt(MCC2)*sqrt(MCC3)
    
    
    MCC[i,1]  = MCC1/MCC4
  }
  rm(TP)
  rm(FP)
  rm(TN)
  rm(FN)
  results_ACC <- mean_and_sd(ACC)
  results_SENS <- mean_and_sd(SENS)
  results_SPEC <- mean_and_sd(SPEC)
  results_MCC <- mean_and_sd(MCC)
  rm(ACC)
  rm(SENS)
  rm(SPEC)
  rm(MCC)
  results_all <- (data.frame(c(results_ACC, results_SENS, results_SPEC, results_MCC)))
  rownames(results_all) <- c("ACC_Mean", "ACC_SD", "Sens_Mean", "Sens_SD", "Spec_Mean", "Spec_SD",
                             "MCC_Mean", "MCC_SD")
  rm(results_ACC)
  rm(results_SENS)
  rm(results_SPEC)
  rm(results_MCC)
  return(results_all)
}


J48_training_all <- function(x) {
  bacteria <- results_training_Bacteria(x)
  cancer <- results_training_Cancer(x)
  fungus <- results_training_Fungus(x)
  virus <- results_training_Virus(x)
  results_all <- cbind(bacteria, cancer, fungus, virus)
  rm(bacteria)
  rm(cancer)
  rm(fungus)
  rm(virus)
  total <- apply(results_all, 1, mean)
  results_all_mean <- cbind(results_all, total)
  rm(results_all)
  rm(total)
  colnames(results_all_mean) <- c("Bacteria", "Cancer", "Fungus", "Virus", "Overall")
  return(results_all_mean)
}


### 10-fold Cross-Validation

J48_10_CV <- function(x, Label){
  if (Label == "Bacteria") {
    suppressPackageStartupMessages(library(parallel))
    suppressPackageStartupMessages(library(doSNOW))
    cl <- makeCluster(8)
    registerDoSNOW(cl)
    
    ok <- list(100)
    ok <- foreach(i = 1:100) %dopar% { 
      in_train <- caret::createDataPartition(x$Label, p = 0.80, list = FALSE)
      train <- x[in_train, ]
      test <- x[-in_train, ]
      rm(in_train)
      rm(test)
      model_train <- RWeka::J48(Label~., data = train)
      results <- RWeka::evaluate_Weka_classifier(model_train, newata = NULL, numFolds = 10, complexity = FALSE)
      rm(train)
      confusionMatrix <- results$confusionMatrix
      rm(model_train)
      results <- as.numeric(confusionMatrix)
      rm(confusionMatrix)
      ok[[i]] <- cbind(results[[1]], (results[[5]] + results[[9]] + results[[13]]),
                       (results[[2]] + results[[3]] + results[[4]]), (results[[6]] + results[[11]] + results[[16]]))
      Cancer <- cbind(results[[6]], (results[[2]] + results[[10]] + results[[14]]), 
                      (results[[5]] + results[[7]] + results[[8]]), (results[[1]] + results[[11]] + results[[16]]))
      Fungus <- cbind(results[[11]], (results[[3]] + results[[7]] + results[[15]]),
                      (results[[9]] + results[[10]] + results[[12]]), (results[[1]] + results[[6]] + results[[16]]))
      Virus <- cbind(results[[16]], (results[[4]] + results[[8]] + results[[12]]), 
                     (results[[13]] + results[[14]] + results[[15]]), (results[[1]] + results[[6]] + results[[11]]))
    }
  }  else if (Label == "Cancer") {
    cl <- makeCluster(8)
    registerDoSNOW(cl)
    
    ok <- list(100)
    ok <- foreach(i = 1:100) %dopar% { 
      in_train <- caret::createDataPartition(x$Label, p = 0.80, list = FALSE)
      train <- x[in_train, ]
      test <- x[-in_train, ]
      rm(in_train)
      rm(test)
      model_train <- RWeka::J48(Label~., data = train)
      results <- RWeka::evaluate_Weka_classifier(model_train, newata = NULL, numFolds = 10, complexity = FALSE)
      rm(train)
      confusionMatrix <- results$confusionMatrix
      rm(model_train)
      results <- as.numeric(confusionMatrix)
      rm(confusionMatrix)
      Bacteria <- cbind(results[[1]], (results[[5]] + results[[9]] + results[[13]]),
                        (results[[2]] + results[[3]] + results[[4]]), (results[[6]] + results[[11]] + results[[16]]))
      ok[[i]] <- cbind(results[[6]], (results[[2]] + results[[10]] + results[[14]]), 
                       (results[[5]] + results[[7]] + results[[8]]), (results[[1]] + results[[11]] + results[[16]]))
      Fungus <- cbind(results[[11]], (results[[3]] + results[[7]] + results[[15]]),
                      (results[[9]] + results[[10]] + results[[12]]), (results[[1]] + results[[6]] + results[[16]]))
      Virus <- cbind(results[[16]], (results[[4]] + results[[8]] + results[[12]]), 
                     (results[[13]] + results[[14]] + results[[15]]), (results[[1]] + results[[6]] + results[[11]]))    
    } 
  }  else if (Label == "Fungus") {
    cl <- makeCluster(8)
    registerDoSNOW(cl)
    
    ok <- list(100)
    ok <- foreach(i = 1:100) %dopar% { 
      in_train <- caret::createDataPartition(x$Label, p = 0.80, list = FALSE)
      train <- x[in_train, ]
      test <- x[-in_train, ]
      rm(in_train)
      rm(test)
      model_train <- RWeka::J48(Label~., data = train)
      results <- RWeka::evaluate_Weka_classifier(model_train, newata = NULL, numFolds = 10, complexity = FALSE)
      rm(train)
      rm(model_train)
      confusionMatrix <- results$confusionMatrix
      rm(results)
      results <- as.numeric(confusionMatrix)
      rm(confusionMatrix)
      Bacteria <- cbind(results[[1]], (results[[5]] + results[[9]] + results[[13]]),
                        (results[[2]] + results[[3]] + results[[4]]), (results[[6]] + results[[11]] + results[[16]]))
      Cancer <- cbind(results[[6]], (results[[2]] + results[[10]] + results[[14]]), 
                      (results[[5]] + results[[7]] + results[[8]]), (results[[1]] + results[[11]] + results[[16]]))
      ok[[i]] <- cbind(results[[11]], (results[[3]] + results[[7]] + results[[15]]),
                       (results[[9]] + results[[10]] + results[[12]]), (results[[1]] + results[[6]] + results[[16]]))
      Virus <- cbind(results[[16]], (results[[4]] + results[[8]] + results[[12]]), 
                     (results[[13]] + results[[14]] + results[[15]]), (results[[1]] + results[[6]] + results[[11]]))    
    } 
  }  else if (Label == "Virus") {
    cl <- makeCluster(8)
    registerDoSNOW(cl)
    
    ok <- list(100)
    ok <- foreach(i = 1:100) %dopar% { 
      in_train <- caret::createDataPartition(x$Label, p = 0.80, list = FALSE)
      train <- x[in_train, ]
      test <- x[-in_train, ]
      rm(in_train)
      rm(test)
      model_train <- RWeka::J48(Label~., data = train)
      results <- RWeka::evaluate_Weka_classifier(model_train, newata = NULL, numFolds = 10, complexity = FALSE)
      rm(model_train)
      rm(train)
      confusionMatrix <- results$confusionMatrix
      results <- as.numeric(confusionMatrix)
      rm(confusionMatrix)
      Bacteria <- cbind(results[[1]], (results[[5]] + results[[9]] + results[[13]]),
                        (results[[2]] + results[[3]] + results[[4]]), (results[[6]] + results[[11]] + results[[16]]))
      Cancer <- cbind(results[[6]], (results[[2]] + results[[10]] + results[[14]]), 
                      (results[[5]] + results[[7]] + results[[8]]), (results[[1]] + results[[11]] + results[[16]]))
      Fungus <- cbind(results[[11]], (results[[3]] + results[[7]] + results[[15]]),
                      (results[[9]] + results[[10]] + results[[12]]), (results[[1]] + results[[6]] + results[[16]]))
      ok[[i]] <- cbind(results[[16]], (results[[4]] + results[[8]] + results[[12]]), 
                       (results[[13]] + results[[14]] + results[[15]]), (results[[1]] + results[[6]] + results[[11]]))    
    }
    return(ok)
    stopCluster(cl)
  } }

mean_and_sd <- function(x) {
  c(round(mean(x, na.rm = TRUE), digits = 4),
    round(sd(x, na.rm = TRUE), digits = 4))
}


results_CV_Bacteria <- function(x) {
  yes <- J48_10_CV(x, Label = "Bacteria")
  great <- data.frame(yes)
  rm(yes)
  TP <- seq(from = 1, to = 400, by = 4)
  FN <- seq(from = 2, to = 400, by = 4)
  FP <- seq(from = 3, to = 400, by = 4)
  TN <- seq(from = 4, to = 400, by = 4)
  results <- mapply(c, great[TP], great[FN], great[FP], great[TN])
  data <- data.frame(results)
  rm(great)
  rm(results)
  m = ncol(data)
  ACC  <- matrix(nrow = m, ncol = 1)
  SENS  <- matrix(nrow = m, ncol = 1)
  SPEC  <-matrix(nrow = m, ncol = 1)
  MCC <- matrix(nrow = m, ncol = 1)
  
  for(i in 1:m){ 
    ACC[i,1]  = (data[1,i]+data[4,i])/(data[1,i]+data[2,i]+data[3,i]+data[4,i])*100
    SENS[i,1]  =  (data[4,i])/(data[3,i]+data[4,i])*100
    SPEC[i,1]  = (data[1,i]/(data[1,i]+data[2,i]))*100
    MCC1      = (data[1,i]*data[4,i]) - (data[2,i]*data[3,i])
    MCC2      =  (data[4,i]+data[2,i])*(data[4,i]+data[3,i])
    MCC3      =  (data[1,i]+data[2,i])*(data[1,i]+data[3,i])
    MCC4  =  sqrt(MCC2)*sqrt(MCC3)
    
    
    MCC[i,1]  = MCC1/MCC4
  }
  rm(TP)
  rm(FP)
  rm(TN)
  rm(FN)
  results_ACC <- mean_and_sd(ACC)
  results_SENS <- mean_and_sd(SENS)
  results_SPEC <- mean_and_sd(SPEC)
  results_MCC <- mean_and_sd(MCC)
  rm(data)
  rm(ACC)
  rm(SENS)
  rm(SPEC)
  rm(MCC)
  results_all <- (data.frame(c(results_ACC, results_SENS, results_SPEC, results_MCC)))
  rownames(results_all) <- c("ACC_Mean", "ACC_SD", "Sens_Mean", "Sens_SD", "Spec_Mean", "Spec_SD",
                             "MCC_Mean", "MCC_SD")
  rm(results_ACC)
  rm(results_SENS)
  rm(results_SPEC)
  rm(results_MCC)
  return(results_all)
}

results_CV_Cancer <- function(x) {
  yes <- J48_10_CV(x, Label = "Cancer")
  great <- data.frame(yes)
  rm(yes)
  TP <- seq(from = 1, to = 400, by = 4)
  FN <- seq(from = 2, to = 400, by = 4)
  FP <- seq(from = 3, to = 400, by = 4)
  TN <- seq(from = 4, to = 400, by = 4)
  results <- mapply(c, great[TP], great[FN], great[FP], great[TN])
  data <- data.frame(results)
  rm(great)
  rm(results)
  m = ncol(data)
  ACC  <- matrix(nrow = m, ncol = 1)
  SENS  <- matrix(nrow = m, ncol = 1)
  SPEC  <-matrix(nrow = m, ncol = 1)
  MCC <- matrix(nrow = m, ncol = 1)
  
  for(i in 1:m){ 
    ACC[i,1]  = (data[1,i]+data[4,i])/(data[1,i]+data[2,i]+data[3,i]+data[4,i])*100
    SENS[i,1]  =  (data[4,i])/(data[3,i]+data[4,i])*100
    SPEC[i,1]  = (data[1,i]/(data[1,i]+data[2,i]))*100
    MCC1      = (data[1,i]*data[4,i]) - (data[2,i]*data[3,i])
    MCC2      =  (data[4,i]+data[2,i])*(data[4,i]+data[3,i])
    MCC3      =  (data[1,i]+data[2,i])*(data[1,i]+data[3,i])
    MCC4  =  sqrt(MCC2)*sqrt(MCC3)
    
    
    MCC[i,1]  = MCC1/MCC4
  }
  rm(TP)
  rm(FP)
  rm(TN)
  rm(FN)
  results_ACC <- mean_and_sd(ACC)
  results_SENS <- mean_and_sd(SENS)
  results_SPEC <- mean_and_sd(SPEC)
  results_MCC <- mean_and_sd(MCC)
  rm(data)
  rm(ACC)
  rm(SENS)
  rm(SPEC)
  rm(MCC)
  results_all <- (data.frame(c(results_ACC, results_SENS, results_SPEC, results_MCC)))
  rownames(results_all) <- c("ACC_Mean", "ACC_SD", "Sens_Mean", "Sens_SD", "Spec_Mean", "Spec_SD",
                             "MCC_Mean", "MCC_SD")
  rm(results_ACC)
  rm(results_SENS)
  rm(results_SPEC)
  rm(results_MCC)
  return(results_all)
}


results_CV_Fungus <- function(x) {
  yes <- J48_10_CV(x, Label = "Fungus")
  great <- data.frame(yes)
  rm(yes)
  TP <- seq(from = 1, to = 400, by = 4)
  FN <- seq(from = 2, to = 400, by = 4)
  FP <- seq(from = 3, to = 400, by = 4)
  TN <- seq(from = 4, to = 400, by = 4)
  results <- mapply(c, great[TP], great[FN], great[FP], great[TN])
  data <- data.frame(results)
  rm(great)
  rm(results)
  m = ncol(data)
  ACC  <- matrix(nrow = m, ncol = 1)
  SENS  <- matrix(nrow = m, ncol = 1)
  SPEC  <-matrix(nrow = m, ncol = 1)
  MCC <- matrix(nrow = m, ncol = 1)
  
  for(i in 1:m){ 
    ACC[i,1]  = (data[1,i]+data[4,i])/(data[1,i]+data[2,i]+data[3,i]+data[4,i])*100
    SENS[i,1]  =  (data[4,i])/(data[3,i]+data[4,i])*100
    SPEC[i,1]  = (data[1,i]/(data[1,i]+data[2,i]))*100
    MCC1      = (data[1,i]*data[4,i]) - (data[2,i]*data[3,i])
    MCC2      =  (data[4,i]+data[2,i])*(data[4,i]+data[3,i])
    MCC3      =  (data[1,i]+data[2,i])*(data[1,i]+data[3,i])
    MCC4  =  sqrt(MCC2)*sqrt(MCC3)
    
    
    MCC[i,1]  = MCC1/MCC4
  }
  rm(TP)
  rm(FP)
  rm(TN)
  rm(FN)
  results_ACC <- mean_and_sd(ACC)
  results_SENS <- mean_and_sd(SENS)
  results_SPEC <- mean_and_sd(SPEC)
  results_MCC <- mean_and_sd(MCC)
  rm(data)
  rm(ACC)
  rm(SENS)
  rm(SPEC)
  rm(MCC)
  results_all <- (data.frame(c(results_ACC, results_SENS, results_SPEC, results_MCC)))
  rownames(results_all) <- c("ACC_Mean", "ACC_SD", "Sens_Mean", "Sens_SD", "Spec_Mean", "Spec_SD",
                             "MCC_Mean", "MCC_SD")
  rm(results_ACC)
  rm(results_SENS)
  rm(results_SPEC)
  rm(results_MCC)
  return(results_all)
}

results_CV_Virus <- function(x) {
  yes <- J48_10_CV(x, Label = "Virus")
  great <- data.frame(yes)
  rm(yes)
  TP <- seq(from = 1, to = 400, by = 4)
  FN <- seq(from = 2, to = 400, by = 4)
  FP <- seq(from = 3, to = 400, by = 4)
  TN <- seq(from = 4, to = 400, by = 4)
  results <- mapply(c, great[TP], great[FN], great[FP], great[TN])
  data <- data.frame(results)
  rm(great)
  rm(results)
  m = ncol(data)
  ACC  <- matrix(nrow = m, ncol = 1)
  SENS  <- matrix(nrow = m, ncol = 1)
  SPEC  <-matrix(nrow = m, ncol = 1)
  MCC <- matrix(nrow = m, ncol = 1)
  
  for(i in 1:m){ 
    ACC[i,1]  = (data[1,i]+data[4,i])/(data[1,i]+data[2,i]+data[3,i]+data[4,i])*100
    SENS[i,1]  =  (data[4,i])/(data[3,i]+data[4,i])*100
    SPEC[i,1]  = (data[1,i]/(data[1,i]+data[2,i]))*100
    MCC1      = (data[1,i]*data[4,i]) - (data[2,i]*data[3,i])
    MCC2      =  (data[4,i]+data[2,i])*(data[4,i]+data[3,i])
    MCC3      =  (data[1,i]+data[2,i])*(data[1,i]+data[3,i])
    MCC4  =  sqrt(MCC2)*sqrt(MCC3)
    
    
    MCC[i,1]  = MCC1/MCC4
  }
  rm(TP)
  rm(FP)
  rm(TN)
  rm(FN)
  results_ACC <- mean_and_sd(ACC)
  results_SENS <- mean_and_sd(SENS)
  results_SPEC <- mean_and_sd(SPEC)
  results_MCC <- mean_and_sd(MCC)
  rm(data)
  rm(ACC)
  rm(SENS)
  rm(SPEC)
  rm(MCC)
  results_all <- (data.frame(c(results_ACC, results_SENS, results_SPEC, results_MCC)))
  rownames(results_all) <- c("ACC_Mean", "ACC_SD", "Sens_Mean", "Sens_SD", "Spec_Mean", "Spec_SD",
                             "MCC_Mean", "MCC_SD")
  rm(results_ACC)
  rm(results_SENS)
  rm(results_SPEC)
  rm(results_MCC)
  return(results_all)
}

J48_CV_all <- function(x) {
  bacteria <- results_CV_Bacteria(x)
  cancer <- results_CV_Cancer(x)
  fungus <- results_CV_Fungus(x)
  virus <- results_CV_Virus(x)
  results_all <- cbind(bacteria, cancer, fungus, virus)
  rm(bacteria)
  rm(cancer)
  rm(fungus)
  rm(virus)
  total <- apply(results_all, 1, mean)
  results_all_mean <- cbind(results_all, total)
  rm(results_all)
  rm(total)
  colnames(results_all_mean) <- c("Bacteria", "Cancer", "Fungus", "Virus", "Overall")
  return(results_all_mean)
}

#### Results for Testing set

J48_testing <- function(x, Label){
  if (Label == "Bacteria") {
    suppressPackageStartupMessages(library(parallel))
    suppressPackageStartupMessages(library(doSNOW))
    cl <- makeCluster(8)
    registerDoSNOW(cl)
    
    ok <- list(100)
    ok <- foreach(i = 1:100) %dopar% { 
      in_train <- caret::createDataPartition(x$Label, p = 0.80, list = FALSE)
      train <- x[in_train, ]
      test <- x[-in_train, ]
      rm(in_train)
      model_train <- RWeka::J48(Label~., data = train)
      rm(train)
      actual <- test$Label
      prediction <- predict(model_train, test)
      rm(model_train)
      rm(test)
      results <- caret::confusionMatrix(prediction, actual)
      results <- results$table
      results <- table(prediction, actual)
      rm(prediction)
      rm(actual)
      results <- as.numeric(results)
      ok[[i]] <- cbind(results[[1]], (results[[5]] + results[[9]] + results[[13]]),
                       (results[[2]] + results[[3]] + results[[4]]), (results[[6]] + results[[11]] + results[[16]]))
      Cancer <- cbind(results[[6]], (results[[2]] + results[[10]] + results[[14]]), 
                      (results[[5]] + results[[7]] + results[[8]]), (results[[1]] + results[[11]] + results[[16]]))
      Fungus <- cbind(results[[11]], (results[[3]] + results[[7]] + results[[15]]),
                      (results[[9]] + results[[10]] + results[[12]]), (results[[1]] + results[[6]] + results[[16]]))
      Virus <- cbind(results[[16]], (results[[4]] + results[[8]] + results[[12]]), 
                     (results[[13]] + results[[14]] + results[[15]]), (results[[1]] + results[[6]] + results[[11]]))
    }
  }  else if (Label == "Cancer") {
    cl <- makeCluster(8)
    registerDoSNOW(cl)
    
    ok <- list(100)
    ok <- foreach(i = 1:100) %dopar% { 
      in_train <- caret::createDataPartition(x$Label, p = 0.80, list = FALSE)
      train <- x[in_train, ]
      test <- x[-in_train, ]
      rm(in_train)
      model_train <- RWeka::J48(Label~., data = train)
      rm(train)
      actual <- test$Label
      prediction <- predict(model_train, test)
      rm(model_train)
      rm(test)
      results <- caret::confusionMatrix(prediction, actual)
      results <- results$table
      results <- table(prediction, actual)
      results <- as.numeric(results)
      rm(prediction)
      rm(actual)
      Bacteria <- cbind(results[[1]], (results[[5]] + results[[9]] + results[[13]]),
                        (results[[2]] + results[[3]] + results[[4]]), (results[[6]] + results[[11]] + results[[16]]))
      ok[[i]] <- cbind(results[[6]], (results[[2]] + results[[10]] + results[[14]]), 
                       (results[[5]] + results[[7]] + results[[8]]), (results[[1]] + results[[11]] + results[[16]]))
      Fungus <- cbind(results[[11]], (results[[3]] + results[[7]] + results[[15]]),
                      (results[[9]] + results[[10]] + results[[12]]), (results[[1]] + results[[6]] + results[[16]]))
      Virus <- cbind(results[[16]], (results[[4]] + results[[8]] + results[[12]]), 
                     (results[[13]] + results[[14]] + results[[15]]), (results[[1]] + results[[6]] + results[[11]]))    
    } 
  }  else if (Label == "Fungus") {
    cl <- makeCluster(8)
    registerDoSNOW(cl)
    
    ok <- list(100)
    ok <- foreach(i = 1:100) %dopar% { 
      in_train <- caret::createDataPartition(x$Label, p = 0.80, list = FALSE)
      train <- x[in_train, ]
      test <- x[-in_train, ]
      rm(in_train)
      model_train <- RWeka::J48(Label~., data = train)
      rm(train)
      actual <- test$Label
      prediction <- predict(model_train, test)
      rm(model_train)
      rm(test)
      results <- caret::confusionMatrix(prediction, actual)
      results <- results$table
      results <- table(prediction, actual)
      results <- as.numeric(results)
      rm(prediction)
      rm(actual)
      Bacteria <- cbind(results[[1]], (results[[5]] + results[[9]] + results[[13]]),
                        (results[[2]] + results[[3]] + results[[4]]), (results[[6]] + results[[11]] + results[[16]]))
      Cancer <- cbind(results[[6]], (results[[2]] + results[[10]] + results[[14]]), 
                      (results[[5]] + results[[7]] + results[[8]]), (results[[1]] + results[[11]] + results[[16]]))
      ok[[i]] <- cbind(results[[11]], (results[[3]] + results[[7]] + results[[15]]),
                       (results[[9]] + results[[10]] + results[[12]]), (results[[1]] + results[[6]] + results[[16]]))
      Virus <- cbind(results[[16]], (results[[4]] + results[[8]] + results[[12]]), 
                     (results[[13]] + results[[14]] + results[[15]]), (results[[1]] + results[[6]] + results[[11]]))    
    } 
  }  else if (Label == "Virus") {
    cl <- makeCluster(8)
    registerDoSNOW(cl)
    
    ok <- list(100)
    ok <- foreach(i = 1:100) %dopar% { 
      in_train <- caret::createDataPartition(x$Label, p = 0.80, list = FALSE)
      train <- x[in_train, ]
      test <- x[-in_train, ]
      rm(in_train)
      model_train <- RWeka::J48(Label~., data = train)
      rm(train)
      actual <- test$Label
      prediction <- predict(model_train, test)
      rm(model_train)
      rm(test)
      results <- caret::confusionMatrix(prediction, actual)
      results <- results$table
      results <- table(prediction, actual)
      results <- as.numeric(results)
      rm(prediction)
      rm(actual)
      Bacteria <- cbind(results[[1]], (results[[5]] + results[[9]] + results[[13]]),
                        (results[[2]] + results[[3]] + results[[4]]), (results[[6]] + results[[11]] + results[[16]]))
      Cancer <- cbind(results[[6]], (results[[2]] + results[[10]] + results[[14]]), 
                      (results[[5]] + results[[7]] + results[[8]]), (results[[1]] + results[[11]] + results[[16]]))
      Fungus <- cbind(results[[11]], (results[[3]] + results[[7]] + results[[15]]),
                      (results[[9]] + results[[10]] + results[[12]]), (results[[1]] + results[[6]] + results[[16]]))
      ok[[i]] <- cbind(results[[16]], (results[[4]] + results[[8]] + results[[12]]), 
                       (results[[13]] + results[[14]] + results[[15]]), (results[[1]] + results[[6]] + results[[11]]))    
    }
    return(ok)
    stopCluster(cl)
  } }

mean_and_sd <- function(x) {
  c(round(mean(x, na.rm = TRUE), digits = 4),
    round(sd(x, na.rm = TRUE), digits = 4))
}


results_testing_Bacteria <- function(x) {
  yes <- J48_testing(x, Label = "Bacteria")
  great <- data.frame(yes)
  rm(yes)
  TP <- seq(from = 1, to = 400, by = 4)
  FN <- seq(from = 2, to = 400, by = 4)
  FP <- seq(from = 3, to = 400, by = 4)
  TN <- seq(from = 4, to = 400, by = 4)
  results <- mapply(c, great[TP], great[FN], great[FP], great[TN])
  data <- data.frame(results)
  rm(great)
  rm(results)
  m = ncol(data)
  ACC  <- matrix(nrow = m, ncol = 1)
  SENS  <- matrix(nrow = m, ncol = 1)
  SPEC  <-matrix(nrow = m, ncol = 1)
  MCC <- matrix(nrow = m, ncol = 1)
  
  for(i in 1:m){ 
    ACC[i,1]  = (data[1,i]+data[4,i])/(data[1,i]+data[2,i]+data[3,i]+data[4,i])*100
    SENS[i,1]  =  (data[4,i])/(data[3,i]+data[4,i])*100
    SPEC[i,1]  = (data[1,i]/(data[1,i]+data[2,i]))*100
    MCC1      = (data[1,i]*data[4,i]) - (data[2,i]*data[3,i])
    MCC2      =  (data[4,i]+data[2,i])*(data[4,i]+data[3,i])
    MCC3      =  (data[1,i]+data[2,i])*(data[1,i]+data[3,i])
    MCC4  =  sqrt(MCC2)*sqrt(MCC3)
    
    
    MCC[i,1]  = MCC1/MCC4
  }
  rm(TP)
  rm(FP)
  rm(TN)
  rm(FN)
  results_ACC <- mean_and_sd(ACC)
  results_SENS <- mean_and_sd(SENS)
  results_SPEC <- mean_and_sd(SPEC)
  results_MCC <- mean_and_sd(MCC)
  rm(ACC)
  rm(SENS)
  rm(SPEC)
  rm(MCC)
  rm(data)
  results_all <- (data.frame(c(results_ACC, results_SENS, results_SPEC, results_MCC)))
  rownames(results_all) <- c("ACC_Mean", "ACC_SD", "Sens_Mean", "Sens_SD", "Spec_Mean", "Spec_SD",
                             "MCC_Mean", "MCC_SD")
  rm(results_ACC)
  rm(results_SENS)
  rm(results_SPEC)
  rm(results_MCC)
  return(results_all)
}

results_testing_Cancer <- function(x) {
  yes <- J48_testing(x, Label = "Cancer")
  great <- data.frame(yes)
  rm(yes)
  TP <- seq(from = 1, to = 400, by = 4)
  FN <- seq(from = 2, to = 400, by = 4)
  FP <- seq(from = 3, to = 400, by = 4)
  TN <- seq(from = 4, to = 400, by = 4)
  results <- mapply(c, great[TP], great[FN], great[FP], great[TN])
  data <- data.frame(results)
  rm(great)
  rm(results)
  m = ncol(data)
  ACC  <- matrix(nrow = m, ncol = 1)
  SENS  <- matrix(nrow = m, ncol = 1)
  SPEC  <-matrix(nrow = m, ncol = 1)
  MCC <- matrix(nrow = m, ncol = 1)
  
  for(i in 1:m){ 
    ACC[i,1]  = (data[1,i]+data[4,i])/(data[1,i]+data[2,i]+data[3,i]+data[4,i])*100
    SENS[i,1]  =  (data[4,i])/(data[3,i]+data[4,i])*100
    SPEC[i,1]  = (data[1,i]/(data[1,i]+data[2,i]))*100
    MCC1      = (data[1,i]*data[4,i]) - (data[2,i]*data[3,i])
    MCC2      =  (data[4,i]+data[2,i])*(data[4,i]+data[3,i])
    MCC3      =  (data[1,i]+data[2,i])*(data[1,i]+data[3,i])
    MCC4  =  sqrt(MCC2)*sqrt(MCC3)
    
    
    MCC[i,1]  = MCC1/MCC4
  }
  rm(TP)
  rm(FP)
  rm(TN)
  rm(FN)
  results_ACC <- mean_and_sd(ACC)
  results_SENS <- mean_and_sd(SENS)
  results_SPEC <- mean_and_sd(SPEC)
  results_MCC <- mean_and_sd(MCC)
  rm(ACC)
  rm(SENS)
  rm(SPEC)
  rm(MCC)
  rm(data)
  results_all <- (data.frame(c(results_ACC, results_SENS, results_SPEC, results_MCC)))
  rownames(results_all) <- c("ACC_Mean", "ACC_SD", "Sens_Mean", "Sens_SD", "Spec_Mean", "Spec_SD",
                             "MCC_Mean", "MCC_SD")
  rm(results_ACC)
  rm(results_SENS)
  rm(results_SPEC)
  rm(results_MCC)
  return(results_all)
}


results_testing_Fungus <- function(x) {
  yes <- J48_testing(x, Label = "Fungus")
  great <- data.frame(yes)
  rm(yes)
  TP <- seq(from = 1, to = 400, by = 4)
  FN <- seq(from = 2, to = 400, by = 4)
  FP <- seq(from = 3, to = 400, by = 4)
  TN <- seq(from = 4, to = 400, by = 4)
  results <- mapply(c, great[TP], great[FN], great[FP], great[TN])
  data <- data.frame(results)
  rm(great)
  rm(results)
  m = ncol(data)
  ACC  <- matrix(nrow = m, ncol = 1)
  SENS  <- matrix(nrow = m, ncol = 1)
  SPEC  <-matrix(nrow = m, ncol = 1)
  MCC <- matrix(nrow = m, ncol = 1)
  
  for(i in 1:m){ 
    ACC[i,1]  = (data[1,i]+data[4,i])/(data[1,i]+data[2,i]+data[3,i]+data[4,i])*100
    SENS[i,1]  =  (data[4,i])/(data[3,i]+data[4,i])*100
    SPEC[i,1]  = (data[1,i]/(data[1,i]+data[2,i]))*100
    MCC1      = (data[1,i]*data[4,i]) - (data[2,i]*data[3,i])
    MCC2      =  (data[4,i]+data[2,i])*(data[4,i]+data[3,i])
    MCC3      =  (data[1,i]+data[2,i])*(data[1,i]+data[3,i])
    MCC4  =  sqrt(MCC2)*sqrt(MCC3)
    
    
    MCC[i,1]  = MCC1/MCC4
  }
  rm(TP)
  rm(FP)
  rm(TN)
  rm(FN)
  results_ACC <- mean_and_sd(ACC)
  results_SENS <- mean_and_sd(SENS)
  results_SPEC <- mean_and_sd(SPEC)
  results_MCC <- mean_and_sd(MCC)
  rm(ACC)
  rm(SENS)
  rm(SPEC)
  rm(MCC)
  rm(data)
  results_all <- (data.frame(c(results_ACC, results_SENS, results_SPEC, results_MCC)))
  rownames(results_all) <- c("ACC_Mean", "ACC_SD", "Sens_Mean", "Sens_SD", "Spec_Mean", "Spec_SD",
                             "MCC_Mean", "MCC_SD")
  rm(results_ACC)
  rm(results_SENS)
  rm(results_SPEC)
  rm(results_MCC)
  return(results_all)
}

results_testing_Virus <- function(x) {
  yes <- J48_testing(x, Label = "Virus")
  great <- data.frame(yes)
  rm(yes)
  TP <- seq(from = 1, to = 400, by = 4)
  FN <- seq(from = 2, to = 400, by = 4)
  FP <- seq(from = 3, to = 400, by = 4)
  TN <- seq(from = 4, to = 400, by = 4)
  results <- mapply(c, great[TP], great[FN], great[FP], great[TN])
  data <- data.frame(results)
  rm(great)
  rm(results)
  m = ncol(data)
  ACC  <- matrix(nrow = m, ncol = 1)
  SENS  <- matrix(nrow = m, ncol = 1)
  SPEC  <-matrix(nrow = m, ncol = 1)
  MCC <- matrix(nrow = m, ncol = 1)
  
  for(i in 1:m){ 
    ACC[i,1]  = (data[1,i]+data[4,i])/(data[1,i]+data[2,i]+data[3,i]+data[4,i])*100
    SENS[i,1]  =  (data[4,i])/(data[3,i]+data[4,i])*100
    SPEC[i,1]  = (data[1,i]/(data[1,i]+data[2,i]))*100
    MCC1      = (data[1,i]*data[4,i]) - (data[2,i]*data[3,i])
    MCC2      =  (data[4,i]+data[2,i])*(data[4,i]+data[3,i])
    MCC3      =  (data[1,i]+data[2,i])*(data[1,i]+data[3,i])
    MCC4  =  sqrt(MCC2)*sqrt(MCC3)
    
    
    MCC[i,1]  = MCC1/MCC4
  }
  rm(TP)
  rm(FP)
  rm(TN)
  rm(FN)
  results_ACC <- mean_and_sd(ACC)
  results_SENS <- mean_and_sd(SENS)
  results_SPEC <- mean_and_sd(SPEC)
  results_MCC <- mean_and_sd(MCC)
  rm(ACC)
  rm(SENS)
  rm(SPEC)
  rm(MCC)
  rm(data)
  results_all <- (data.frame(c(results_ACC, results_SENS, results_SPEC, results_MCC)))
  rownames(results_all) <- c("ACC_Mean", "ACC_SD", "Sens_Mean", "Sens_SD", "Spec_Mean", "Spec_SD",
                             "MCC_Mean", "MCC_SD")
  rm(results_ACC)
  rm(results_SENS)
  rm(results_SPEC)
  rm(results_MCC)
  return(results_all)
}

J48_testing_all <- function(x) {
  bacteria <- results_testing_Bacteria(x)
  cancer <- results_testing_Cancer(x)
  fungus <- results_testing_Fungus(x)
  virus <- results_testing_Virus(x)
  results_all <- cbind(bacteria, cancer, fungus, virus)
  rm(bacteria)
  rm(cancer)
  rm(fungus)
  rm(virus)
  total <- apply(results_all, 1, mean)
  results_all_mean <- cbind(results_all, total)
  rm(results_all)
  rm(total)
  colnames(results_all_mean) <- c("Bacteria", "Cancer", "Fungus", "Virus", "Overall")
  return(results_all_mean)
}



```


### HDPs having their respective activity combined together to build a union predictive model ###

Results for training 

```{r, echo=FALSE, cache = TRUE}
training_results <- suppressWarnings(J48_training_all(combine_data))
print(training_results)
```

Results for CV

```{r, echo=FALSE, cache = TRUE}
CV_results <- suppressWarnings(J48_CV_all(combine_data))
print(CV_results)
```

Results for Testing

```{r, echo=FALSE, cache = TRUE}
testing_results <- suppressWarnings(J48_testing_all(combine_data))
print(testing_results)
```



```{r, echo = FALSE, eval = FALSE}
library(knitr)
library(markdown)
knit("HDP.Rmd", "HDP.md")
markdownToHTML('HDP.md', 'HDP.html') # creates html file
browseURL(paste('file://', file.path(getwd(),'test.html'), sep=''))
```
